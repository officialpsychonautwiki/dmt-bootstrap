digraph G {
    subgraph incoming {
        node [style=filled,color=cornsilk];

        haproxy_h2o -> h2o_1;
        haproxy_h2o -> h2o_2;
        haproxy_h2o -> h2o_3;
        haproxy_h2o -> h2o_4;

        label = "h2o";
        color=blue
    }

    subgraph balance {
        node [style=filled,color=lightblue];

        varnish -> nginx_ruleproxy;

        label = "Caching";
    }

    h2o_1 -> varnish;
    h2o_2 -> varnish;
    h2o_3 -> varnish;
    h2o_4 -> varnish;

    h2o_1 -> countly;
    h2o_2 -> countly;
    h2o_3 -> countly;
    h2o_4 -> countly;

    h2o_1 -> katharsis;
    h2o_2 -> katharsis;
    h2o_3 -> katharsis;
    h2o_4 -> katharsis;

    countly -> mongo_1;

    h2o_1 -> bifrost;
    h2o_2 -> bifrost;
    h2o_3 -> bifrost;
    h2o_4 -> bifrost;

    bifrost -> haproxy_h2o;

    nginx_ruleproxy -> phpfpm;

    phpfpm -> mysql;
    phpfpm -> redis;
    phpfpm -> elasticsearch;
    phpfpm -> eyeOfProvidence;
    phpfpm -> varnish;


    mysql [shape=box];
    redis [shape=box];
    mongo_1 [shape=box];
    elasticsearch [shape=box];
}
